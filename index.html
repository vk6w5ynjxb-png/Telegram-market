<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/telegram-web-app/6.11.0/telegram-web-app.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #b71c1c; /* Ù‚Ø±Ù…Ø² ØªÛŒØ±Ù‡ Ùˆ Ø³Ù†Ú¯ÛŒÙ† */
            --accent: #2196f3;  /* Ø¢Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø®Ø§Øµ */
            --bg: #f8f9fa;
            --white: #ffffff;
            --text: #212121;
            --gray: #757575;
            --border: #e0e0e0;
            --success: #4caf50;
        }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; padding-bottom: 80px; user-select: none; }
        
        /* --- Ø§Ù†ÛŒÙ…ÛŒØ´Ù†â€ŒÙ‡Ø§ --- */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .page { display: none; padding: 15px; padding-top: 60px; animation: fadeIn 0.3s ease-out; }
        .page.active { display: block; }

        /* --- Ù‡Ø¯Ø± --- */
        .header { position: fixed; top: 0; left: 0; right: 0; height: 55px; background: var(--white); display: flex; align-items: center; justify-content: space-between; padding: 0 15px; box-shadow: 0 2px 4px rgba(0,0,0,0.08); z-index: 1000; }
        .search-box { flex: 1; background: #f1f2f6; border-radius: 8px; padding: 8px 12px; display: flex; align-items: center; margin-right: 12px; font-size: 13px; color: var(--gray); border: 1px solid transparent; }
        .search-box:active { border-color: var(--primary); background: #fff; }
        .app-logo { font-weight: 900; color: var(--primary); font-size: 18px; letter-spacing: -1px; }

        /* --- ØµÙØ­Ù‡ Ø®Ø§Ù†Ù‡ (6 Ø¨Ø®Ø´ÛŒ) --- */
        .grid-6 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 10px; }
        .cat-box { background: var(--white); border-radius: 15px; padding: 20px 10px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: 0.2s; border: 1px solid var(--border); }
        .cat-box:active { transform: scale(0.96); border-color: var(--primary); }
        .cat-icon { width: 50px; height: 50px; background: #ffebee; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; color: var(--primary); }
        .cat-title { font-size: 13px; font-weight: bold; color: #333; }

        /* --- Ù„ÛŒØ³Øª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ --- */
        .ad-card { background: var(--white); border-radius: 12px; padding: 10px; margin-bottom: 12px; display: flex; gap: 12px; cursor: pointer; border: 1px solid var(--border); box-shadow: 0 2px 4px rgba(0,0,0,0.03); }
        .ad-img { width: 110px; height: 110px; border-radius: 10px; object-fit: cover; background: #eee; flex-shrink: 0; }
        .ad-content { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .ad-title { font-weight: bold; font-size: 14px; line-height: 1.5; margin-bottom: 5px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
        .ad-meta { font-size: 11px; color: var(--gray); display: flex; align-items: center; gap: 5px; }
        .ad-price { color: var(--text); font-weight: bold; font-size: 15px; margin-top: auto; }
        .ad-badge { background: #f0f0f0; padding: 2px 6px; border-radius: 4px; font-size: 10px; color: #666; }

        /* --- ÙØ±Ù…â€ŒÙ‡Ø§ --- */
        .form-section { background: var(--white); padding: 20px; border-radius: 15px; margin-bottom: 15px; border: 1px solid var(--border); }
        .inp-group { margin-bottom: 15px; }
        label { display: block; font-size: 12px; color: #555; margin-bottom: 6px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 14px; border: 1px solid #ccc; border-radius: 10px; background: #fff; outline: none; font-size: 14px; transition: 0.3s; }
        input:focus, select:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(183, 28, 28, 0.1); }
        
        /* Ø¢Ù¾Ù„ÙˆØ¯ Ø¹Ú©Ø³ */
        .upload-area { border: 2px dashed #999; padding: 30px; text-align: center; border-radius: 12px; cursor: pointer; background: #fafafa; transition: 0.3s; position: relative; overflow: hidden; }
        .upload-area.active { border-color: var(--success); background: #e8f5e9; }
        .upload-preview { width: 100%; height: 200px; object-fit: cover; border-radius: 8px; display: none; margin-top: 10px; }
        .upload-progress { height: 4px; background: var(--success); width: 0%; transition: 0.3s; position: absolute; bottom: 0; left: 0; }
        
        /* Ù¾ÛŒØ´Ù†Ù…Ø§ÛŒØ´ Ú†Ù†Ø¯ Ø¹Ú©Ø³ÛŒ */
        .upload-previews { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 8px; margin-top: 10px; }
        .preview-item { position: relative; width: 100%; padding-bottom: 100%; border-radius: 8px; overflow: hidden; background: #f0f0f0; }
        .preview-item img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; }
        .preview-item .progress-bar { position: absolute; bottom: 0; left: 0; height: 4px; background: var(--success); width: 0%; transition: width 0.3s; }
        .preview-item .remove-btn { position: absolute; top: 5px; right: 5px; width: 20px; height: 20px; background: rgba(0,0,0,0.6); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer; }
        .preview-item .status-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 24px; }

        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ */
        .btn { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; box-shadow: 0 4px 10px rgba(183, 28, 28, 0.3); }
        .btn:active { transform: scale(0.98); }
        .btn-sec { background: #fff; color: var(--text); border: 1px solid #ccc; box-shadow: none; }

        /* --- Ú†Ú© Ø¨Ø§Ú©Ø³â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ú¯ÛŒ --- */
        .amenities-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .check-box { display: flex; align-items: center; gap: 8px; font-size: 13px; background: #f5f5f5; padding: 10px; border-radius: 8px; cursor: pointer; }
        .check-box input { width: auto; margin: 0; }

        /* --- Ù†ÙˆØ§Ø± Ù¾Ø§ÛŒÛŒÙ† --- */
        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; height: 65px; background: var(--white); display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #eee; z-index: 900; padding-bottom: 5px; }
        .nav-item { text-align: center; font-size: 10px; color: #999; flex: 1; cursor: pointer; transition: 0.2s; }
        .nav-item i { font-size: 22px; margin-bottom: 5px; display: block; }
        .nav-item.active { color: var(--primary); transform: translateY(-2px); }
        .nav-item.active i { color: var(--primary); }

        /* --- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ --- */
        .profile-header { text-align: center; padding: 20px 0; border-bottom: 1px solid #eee; }
        .avatar { width: 90px; height: 90px; background: #eee; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #bbb; border: 3px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .verified-badge { color: var(--success); font-size: 14px; display: flex; align-items: center; justify-content: center; gap: 5px; margin-top: 5px; }
        .menu-list { margin-top: 10px; }
        .menu-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; background: white; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
        .menu-item i { color: var(--gray); width: 25px; }
        
        .hidden { display: none !important; }
        .error-txt { color: red; font-size: 11px; margin-top: 5px; display: none; }
    </style>
</head>
<body>

    <div class="header">
        <div class="app-logo">BAZAR</div>
        <div class="search-box">
            <i class="fa fa-search"></i>
            <span style="margin-right: 8px;">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§...</span>
        </div>
    </div>

    <div id="page-home" class="page active">
        <div style="background: linear-gradient(45deg, #b71c1c, #d32f2f); color: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; text-align: center;">
            <h3 style="margin:0;">Ø®Ø±ÛŒØ¯ Ùˆ ÙØ±ÙˆØ´ Ø§Ù…Ù†</h3>
            <p style="margin:5px 0 0; font-size:12px; opacity:0.9;">Ø§ÛŒØ±Ø§Ù† Ùˆ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù† | Ø¨Ø¯ÙˆÙ† ÙˆØ§Ø³Ø·Ù‡</p>
        </div>

        <div style="font-weight:bold; margin-bottom:10px;">Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ</div>
        <div class="grid-6">
            <div class="cat-box" onclick="openCategory('estate')">
                <div class="cat-icon" style="background:#e3f2fd; color:#1976d2;"><i class="fa fa-building"></i></div>
                <div class="cat-title">Ø§Ù…Ù„Ø§Ú© Ùˆ Ù…Ø³Ú©Ù†</div>
            </div>
            <div class="cat-box" onclick="openCategory('cars')">
                <div class="cat-icon" style="background:#ffebee; color:#c62828;"><i class="fa fa-car"></i></div>
                <div class="cat-title">ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡</div>
            </div>
            <div class="cat-box" onclick="openCategory('digital')">
                <div class="cat-icon" style="background:#f3e5f5; color:#7b1fa2;"><i class="fa fa-mobile-alt"></i></div>
                <div class="cat-title">Ú©Ø§Ù„Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</div>
            </div>
            <div class="cat-box" onclick="openCategory('home')">
                <div class="cat-icon" style="background:#e8f5e9; color:#388e3c;"><i class="fa fa-couch"></i></div>
                <div class="cat-title">Ø®Ø§Ù†Ù‡ Ùˆ Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡</div>
            </div>
            <div class="cat-box" onclick="openCategory('parts')">
                <div class="cat-icon" style="background:#fff3e0; color:#f57c00;"><i class="fa fa-tools"></i></div>
                <div class="cat-title">Ø§Ø¨Ø²Ø§Ø± Ùˆ Ù…ØµØ§Ù„Ø­</div>
            </div>
            <div class="cat-box" onclick="openCategory('jobs')">
                <div class="cat-icon" style="background:#eceff1; color:#455a64;"><i class="fa fa-briefcase"></i></div>
                <div class="cat-title">Ú©Ø§Ø± Ùˆ Ø®Ø¯Ù…Ø§Øª</div>
            </div>
        </div>

        <div style="font-weight:bold; margin: 25px 0 10px; display:flex; justify-content:space-between;">
            <span>ØªØ§Ø²Ù‡â€ŒØªØ±ÛŒÙ†â€ŒÙ‡Ø§</span>
            <span style="font-size:12px; color:blue;" onclick="fetchAds()">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ â†»</span>
        </div>
        <div id="home-ads-container">
            <p style="text-align:center; padding:20px; color:#999;">â³ Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø±ÛŒØ§ÙØª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§...</p>
        </div>
    </div>

    <div id="page-list" class="page">
        <div style="display:flex; align-items:center; margin-bottom:15px;">
            <i class="fa fa-arrow-right" onclick="switchTab('home')" style="padding:10px; font-size:18px;"></i>
            <h3 id="list-title" style="margin:0; flex:1; text-align:center;">Ø¹Ù†ÙˆØ§Ù† Ø¯Ø³ØªÙ‡</h3>
            <div style="width:30px;"></div>
        </div>

        <div style="background:white; padding:10px; border-radius:10px; margin-bottom:10px; display:flex; gap:10px;">
            <select id="filter-loc" onchange="applyFilters()">
                <option value="all">ğŸ“ Ù‡Ù…Ù‡ Ù…Ú©Ø§Ù†â€ŒÙ‡Ø§</option>
                <option value="Ø§ÛŒØ±Ø§Ù†">Ø§ÛŒØ±Ø§Ù†</option>
                <option value="Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†">Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</option>
            </select>
            <select id="filter-price" onchange="applyFilters()">
                <option value="all">ğŸ’° Ù‡Ù…Ù‡ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</option>
                <option value="low">Ø§Ø±Ø²Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
                <option value="high">Ú¯Ø±Ø§Ù†â€ŒØªØ±ÛŒÙ†</option>
            </select>
        </div>

        <div id="cat-ads-container"></div>
    </div>

    <div id="page-detail" class="page" style="padding:0; padding-bottom:70px;">
        <img id="d-img" style="width:100%; height:300px; object-fit:cover; background:#eee;">
        <div style="padding:20px; background:white; border-radius:25px 25px 0 0; margin-top:-25px; position:relative; min-height:400px;">
            <div style="display:flex; justify-content:space-between; align-items:start;">
                <h2 id="d-title" style="margin:0; font-size:18px; line-height:1.4;"></h2>
                <div onclick="toggleFav()" style="font-size:24px; color:#ccc;"><i class="far fa-heart" id="fav-icon"></i></div>
            </div>
            
            <div id="d-price" style="font-size:20px; font-weight:bold; color:var(--primary); margin:15px 0;"></div>
            
            <div style="display:flex; gap:15px; color:#666; font-size:13px; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                <span><i class="fa fa-map-marker-alt"></i> <span id="d-loc"></span></span>
                <span><i class="fa fa-tag"></i> <span id="d-cat"></span></span>
            </div>

            <div id="d-details" style="background:#f9f9f9; padding:15px; border-radius:10px; margin-bottom:20px; font-size:13px;"></div>

            <h4 style="margin-bottom:10px;">ØªÙˆØ¶ÛŒØ­Ø§Øª</h4>
            <p id="d-desc" style="line-height:1.8; color:#444; font-size:14px; white-space: pre-line;"></p>

            <br><br>
            <button class="btn" onclick="startChat()">
                <i class="fa fa-comment-dots"></i> Ú†Øª Ø§Ù…Ù† Ø¨Ø§ ÙØ±ÙˆØ´Ù†Ø¯Ù‡
            </button>
            <div style="text-align:center; font-size:11px; color:#999; margin-top:10px;">Ø´Ù…Ø§Ø±Ù‡ Ø´Ù…Ø§ Ù…Ø®ÙÛŒ Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯</div>
        </div>
    </div>

    <div id="page-add" class="page">
        <h3 style="text-align:center;">Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ Ø¬Ø¯ÛŒØ¯</h3>
        
        <div class="form-section">
            <label>Û±. Ø§Ù†ØªØ®Ø§Ø¨ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ:</label>
            <select id="post-cat" onchange="updateForm()">
                <option value="">-- Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ --</option>
                <option value="estate">ğŸ  Ø§Ù…Ù„Ø§Ú© Ùˆ Ù…Ø³Ú©Ù†</option>
                <option value="cars">ğŸš— ÙˆØ³Ø§ÛŒÙ„ Ù†Ù‚Ù„ÛŒÙ‡</option>
                <option value="digital">ğŸ“± Ú©Ø§Ù„Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„</option>
                <option value="home">ğŸ›‹ Ø®Ø§Ù†Ù‡ Ùˆ Ø¢Ø´Ù¾Ø²Ø®Ø§Ù†Ù‡</option>
                <option value="parts">ğŸ”§ Ø§Ø¨Ø²Ø§Ø± Ùˆ Ù…ØµØ§Ù„Ø­</option>
                <option value="jobs">ğŸ‘·â€â™‚ï¸ Ú©Ø§Ø± Ùˆ Ú©Ø§Ø±ÛŒØ§Ø¨ÛŒ</option>
            </select>
        </div>

        <div class="form-section">
            <label>Û². ØªØµÙˆÛŒØ± Ø¢Ú¯Ù‡ÛŒ (Ø§Ø¬Ø¨Ø§Ø±ÛŒ - Ø­Ø¯Ø§Ú©Ø«Ø± Û¸ Ø¹Ú©Ø³):</label>
            <!-- BEGIN multi-image upload block -->
            <div class="upload-area" id="up-area" onclick="document.getElementById('file-in').click()">
                <i class="fa fa-cloud-upload-alt" style="font-size:30px; color:#aaa;"></i>
                <p id="up-txt" style="margin:5px 0;">Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³(Ù‡Ø§) Ø¶Ø±Ø¨Ù‡ Ø¨Ø²Ù†ÛŒØ¯</p>
                <div id="up-previews" class="upload-previews"></div>
                <div class="upload-progress" id="up-prog" style="display:none;"></div>
                <img id="up-prev" class="upload-preview">
            </div>
            <input type="file" id="file-in" hidden accept="image/*" multiple onchange="uploadImages(this)">
            <p class="error-txt" id="err-img">Ù„Ø·ÙØ§ ÛŒÚ© Ø¹Ú©Ø³ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.</p>
            <!-- END multi-image upload block -->
        </div>

        <div class="form-section hidden" id="dyn-sec">
            </div>

        <div class="form-section">
            <label>Û³. Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ:</label>
            <div class="inp-group">
                <div style="display:flex; gap:10px;">
                    <select id="post-country" style="width:40%;">
                        <option value="Ø§ÛŒØ±Ø§Ù†">Ø§ÛŒØ±Ø§Ù†</option>
                        <option value="Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†">Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</option>
                    </select>
                    <input type="text" id="post-city" placeholder="Ø´Ù‡Ø± (Ù…Ø«Ù„Ø§: ØªÙ‡Ø±Ø§Ù† / Ù‡Ø±Ø§Øª)">
                </div>
            </div>
            <div class="inp-group">
                <input type="text" id="post-title" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø¢Ú¯Ù‡ÛŒ (Ù…Ø«Ù„Ø§: Ù¾Ú˜Ùˆ 206 Ø³ÙÛŒØ¯)">
            </div>
            <div class="inp-group">
                <input type="number" id="post-price" placeholder="Ù‚ÛŒÙ…Øª Ú©Ù„ (ØªÙˆÙ…Ø§Ù† / Ø§ÙØºØ§Ù†ÛŒ)">
                <div style="display:flex; align-items:center; gap:5px; margin-top:5px;">
                    <input type="checkbox" id="post-exchange" style="width:auto;"> <span style="font-size:12px;">Ù…Ø§ÛŒÙ„ Ø¨Ù‡ Ù…Ø¹Ø§ÙˆØ¶Ù‡ Ù‡Ø³ØªÙ…</span>
                </div>
            </div>
            <div class="inp-group">
                <textarea id="post-desc" rows="5" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª Ú©Ø§Ù…Ù„ (Ø¬Ø²Ø¦ÛŒØ§ØªØŒ Ø®Ø· Ùˆ Ø®Ø´ØŒ Ø³Ø§Ø¹Øª ØªÙ…Ø§Ø³ Ùˆ...)"></textarea>
            </div>
        </div>

        <button class="btn" onclick="submitAd()">Ø§Ù†ØªØ´Ø§Ø± Ø¢Ú¯Ù‡ÛŒ</button>
        <br>
    </div>

    <div id="page-profile" class="page">
        <div class="profile-header">
            <div class="avatar"><i class="fa fa-user"></i></div>
            <h3 id="prof-name-disp" style="margin:5px 0;">Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯</h3>
            <div class="verified-badge" id="badge-area">
                <i class="fa fa-exclamation-circle" style="color:orange;"></i> Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª Ù†Ø´Ø¯Ù‡
            </div>
        </div>

        <div class="form-section" style="margin-top:15px;">
            <h4 style="margin-top:0;">âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø´Ø®ØµÛŒ</h4>
            <div class="inp-group"><input type="text" id="prof-name" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"></div>
            <div class="inp-group"><input type="text" id="prof-phone" placeholder="Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„"></div>
            <div class="inp-group"><input type="text" id="prof-addr" placeholder="Ø¢Ø¯Ø±Ø³ Ù…Ø­Ù„ Ø³Ú©ÙˆÙ†Øª"></div>
            <div class="inp-group"><input type="email" id="prof-email" placeholder="Ø§ÛŒÙ…ÛŒÙ„ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)"></div>
            <button class="btn btn-sec" onclick="saveProfile()">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªØºÛŒÛŒØ±Ø§Øª</button>
        </div>

        <div class="menu-list">
            <div class="menu-item">
                <span><i class="fa fa-wallet"></i> Ú©ÛŒÙ Ù¾ÙˆÙ„</span>
                <span style="font-size:12px; color:#888;">0 ØªÙˆÙ…Ø§Ù†</span>
            </div>
            <div class="menu-item" onclick="alert('Ù„ÛŒØ³Øª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ù† Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...')">
                <span><i class="fa fa-layer-group"></i> Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ÛŒ Ù…Ù†</span>
                <i class="fa fa-chevron-left" style="width:auto;"></i>
            </div>
            <div class="menu-item" onclick="alert('Ù†Ø´Ø§Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ...')">
                <span><i class="fa fa-heart"></i> Ù†Ø´Ø§Ù†â€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§</span>
                <i class="fa fa-chevron-left" style="width:auto;"></i>
            </div>
        </div>
        <br>
        <div style="text-align:center; color:#ccc; font-size:11px;">Version 2.5 Secure</div>
    </div>

    <div class="nav-bar">
        <div class="nav-item" onclick="switchTab('profile')" id="nav-profile">
            <i class="fa fa-user-circle"></i> Ø­Ø³Ø§Ø¨ Ù…Ù†
        </div>
        <div class="nav-item active" onclick="switchTab('home')" id="nav-home">
            <i class="fa fa-store"></i> Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡
        </div>
        <div class="nav-item" onclick="switchTab('add')" id="nav-add">
            <i class="fa fa-plus-circle" style="font-size:35px; color:var(--primary);"></i> Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ
        </div>
    </div>

    <script>
        // ğŸ”´ğŸ”´ğŸ”´ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø´Ù…Ø§ (Ø¬Ø§ÛŒÚ¯Ø°Ø§Ø±ÛŒ Ø´ÙˆØ¯) ğŸ”´ğŸ”´ğŸ”´
        const IMGBB_KEY = "0f27d5debc484191c582fdfae87fea0b"; 
        const BIN_ID = "6967e3d043b1c97be930be0f"; 
        const MASTER_KEY = "$2a$10$qkOl1I02u1dd9Juv25BMv.IsrpbnJq2vYlA.XxkmrvcMdd6G/Iv8q";

        const tg = (window.Telegram && window.Telegram.WebApp)
          ? window.Telegram.WebApp
          : {
              showPopup: (opts) => {
                console.log('tg.showPopup mock', opts);
                if (opts && (opts.title || opts.message)) {
                  alert((opts.title ? opts.title + '\n' : '') + (opts.message || ''));
                }
              },
              sendData: (d) => { console.log('tg.sendData mock', d); },
              close: () => { console.log('tg.close mock'); },
              expand: () => { /* noop */ }
            };

        // Ù…ØªØºÛŒØ±Ù‡Ø§
        let uploadedImgUrls = []; // Ø¢Ø±Ø§ÛŒÙ‡ Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø¢Ø¯Ø±Ø³â€ŒÙ‡Ø§ÛŒ ØªØµØ§ÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡
        let adsCache = [];
        let currentAd = null;

        // --- Ù…Ø¯ÛŒØ±ÛŒØª ØªØ¨â€ŒÙ‡Ø§ ---
        function switchTab(tab) {
            document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            
            document.getElementById(`page-${tab}`).classList.add('active');
            if(document.getElementById(`nav-${tab}`)) document.getElementById(`nav-${tab}`).classList.add('active');
            
            if(tab === 'home') fetchAds();
            if(tab === 'profile') loadProfile();
            window.scrollTo(0,0);
        }

        // --- Ø¯Ø±ÛŒØ§ÙØª Ø¢Ú¯Ù‡ÛŒâ€ŒÙ‡Ø§ (Ø®ÙˆØ§Ù†Ø¯Ù† Ø§Ø² Ø¬ÛŒØ³ÙˆÙ†â€ŒØ¨ÛŒÙ†) ---
        async function fetchAds() {
            const box = document.getElementById('home-ads-container');
            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: {'X-Master-Key': MASTER_KEY}
                });
                const data = await res.json();
                adsCache = data.record;
                renderAds(adsCache.slice(-20).reverse(), 'home-ads-container'); // 20 ØªØ§ÛŒ Ø¢Ø®Ø±
            } catch(e) {
                box.innerHTML = `<p style='text-align:center; color:red; padding:20px;'>Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ${e.message}</p>`;
            }
        }

        function renderAds(list, containerId) {
            const box = document.getElementById(containerId);
            box.innerHTML = "";
            if(!list || list.length === 0) {
                box.innerHTML = "<p style='text-align:center; color:#999; margin-top:30px;'>Ù‡ÛŒÚ† Ø¢Ú¯Ù‡ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</p>";
                return;
            }
            list.forEach(ad => {
                const img = ad.img || "https://via.placeholder.com/150?text=No+Img";
                const catName = getCatName(ad.cat);
                box.innerHTML += `
                <div class="ad-card" onclick='showDetail(${JSON.stringify(ad)})'>
                    <img src="${img}" class="ad-img">
                    <div class="ad-content">
                        <div class="ad-title">${ad.title}</div>
                        <div class="ad-meta"><span>${catName}</span> | <span>${ad.city}</span></div>
                        <div class="ad-price">${parseInt(ad.price).toLocaleString()}</div>
                    </div>
                </div>`;
            });
        }

        function getCatName(code) {
            const map = {'estate':'Ø§Ù…Ù„Ø§Ú©','cars':'Ø®ÙˆØ¯Ø±Ùˆ','digital':'Ø¯ÛŒØ¬ÛŒØªØ§Ù„','home':'Ø®Ø§Ù†Ù‡','parts':'Ø§Ø¨Ø²Ø§Ø±','jobs':'Ú©Ø§Ø±'};
            return map[code] || code;
        }

        function openCategory(cat) {
            switchTab('list');
            document.getElementById('list-title').innerText = getCatName(cat);
            const filtered = adsCache.filter(a => a.cat === cat);
            renderAds(filtered.reverse(), 'cat-ads-container');
            // Ø°Ø®ÛŒØ±Ù‡ Ú©ØªÚ¯ÙˆØ±ÛŒ ÙØ¹Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±
            window.currentCatFilter = cat;
        }

        function applyFilters() {
            const loc = document.getElementById('filter-loc').value;
            const price = document.getElementById('filter-price').value;
            let list = adsCache.filter(a => window.currentCatFilter ? a.cat === window.currentCatFilter : true);

            if(loc !== 'all') list = list.filter(a => a.country === loc);
            if(price === 'low') list.sort((a,b) => a.price - b.price);
            if(price === 'high') list.sort((a,b) => b.price - a.price);

            renderAds(list, 'cat-ads-container');
        }

        // --- Ø¬Ø²Ø¦ÛŒØ§Øª Ùˆ Ú†Øª ---
        function showDetail(ad) {
            currentAd = ad;
            switchTab('detail');
            document.getElementById('d-img').src = ad.img || "";
            document.getElementById('d-title').innerText = ad.title;
            document.getElementById('d-price').innerText = parseInt(ad.price).toLocaleString() + " ØªÙˆÙ…Ø§Ù†/Ø§ÙØºØ§Ù†ÛŒ";
            document.getElementById('d-loc').innerText = `${ad.city} (${ad.country})`;
            document.getElementById('d-cat').innerText = getCatName(ad.cat);
            document.getElementById('d-desc').innerText = ad.desc;
            
            // Ù†Ù…Ø§ÛŒØ´ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ©
            const table = document.getElementById('d-details');
            table.innerHTML = "";
            if(ad.details) {
                for(const [k, v] of Object.entries(ad.details)) {
                    if(v && v !== "false") {
                        // Ø§Ú¯Ø± Ú†Ú© Ø¨Ø§Ú©Ø³ Ø¨ÙˆØ¯ Ùˆ ØªØ±Ùˆ Ø¨ÙˆØ¯
                        const valDisplay = (v === true || v === "true") ? "Ø¯Ø§Ø±Ø¯ âœ…" : v;
                        table.innerHTML += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:5px 0;"><span>${k}</span><span style="font-weight:bold;">${valDisplay}</span></div>`;
                    }
                }
            }
        }

        function startChat() {
            if(!currentAd) return;
            tg.sendData(JSON.stringify({ action: "chat_request", ad_id: currentAd.id }));
            tg.close();
        }

        // --- Ø¢Ù¾Ù„ÙˆØ¯ Ú†Ù†Ø¯ Ø¹Ú©Ø³ (Ø­Ø¯Ø§Ú©Ø«Ø± 8 Ø¹Ú©Ø³) ---
        const SUCCESS_ICON_DISPLAY_DURATION = 2000;
        let totalFilesToUpload = 0;
        
        function uploadImages(input) {
            const files = Array.from(input.files);
            if(files.length === 0) return;
            
            // Ù…Ø­Ø¯ÙˆØ¯ÛŒØª 8 Ø¹Ú©Ø³
            if(files.length > 8) {
                tg.showPopup({title:'ØªÙˆØ¬Ù‡', message:'Ø­Ø¯Ø§Ú©Ø«Ø± 8 Ø¹Ú©Ø³ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.'});
                return;
            }
            
            const txt = document.getElementById('up-txt');
            const previewsContainer = document.getElementById('up-previews');
            const area = document.getElementById('up-area');
            
            // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¢Ù¾Ù„ÙˆØ¯Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
            uploadedImgUrls = [];
            previewsContainer.replaceChildren();
            document.getElementById('up-prev').style.display = 'none';
            document.getElementById('err-img').style.display = 'none';
            
            txt.innerText = `â³ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù¾Ù„ÙˆØ¯ ${files.length} Ø¹Ú©Ø³...`;
            area.classList.add('active');
            
            // Ø°Ø®ÛŒØ±Ù‡ ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§
            totalFilesToUpload = files.length;
            
            // Ø¢Ù¾Ù„ÙˆØ¯ Ù‡Ø± ÙØ§ÛŒÙ„
            files.forEach((file, index) => {
                uploadSingleFile(file, index, previewsContainer);
            });
        }
        
        function uploadSingleFile(file, index, container) {
            // Ø§ÛŒØ¬Ø§Ø¯ Ø§Ù„Ù…Ù†Øª Ù¾ÛŒØ´Ù†Ù…Ø§ÛŒØ´
            const previewItem = document.createElement('div');
            previewItem.className = 'preview-item';
            previewItem.id = `preview-${index}`;
            
            const img = document.createElement('img');
            const progressBar = document.createElement('div');
            progressBar.className = 'progress-bar';
            
            // Ù¾ÛŒØ´Ù†Ù…Ø§ÛŒØ´ ØªØµÙˆÛŒØ± Ù…Ø­Ù„ÛŒ
            const reader = new FileReader();
            reader.onload = (e) => {
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
            
            previewItem.appendChild(img);
            previewItem.appendChild(progressBar);
            container.appendChild(previewItem);
            
            // Ø¢Ù¾Ù„ÙˆØ¯ Ø¨Ø§ XMLHttpRequest Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ´Ø±ÙØª
            const formData = new FormData();
            formData.append("image", file);
            
            const xhr = new XMLHttpRequest();
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ù¾ÛŒØ´Ø±ÙØª Ø¢Ù¾Ù„ÙˆØ¯
            xhr.upload.addEventListener('progress', (e) => {
                if (e.lengthComputable) {
                    const percentComplete = (e.loaded / e.total) * 100;
                    progressBar.style.width = percentComplete + '%';
                    console.log(`Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± ${index + 1}: ${percentComplete.toFixed(1)}%`);
                }
            });
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø§ØªÙ…Ø§Ù… Ø¢Ù¾Ù„ÙˆØ¯
            xhr.addEventListener('load', () => {
                try {
                    if (xhr.status === 200) {
                        const response = JSON.parse(xhr.responseText);
                        console.log(`Ù¾Ø§Ø³Ø® Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± ${index + 1}:`, response);
                        
                        if(response.success && response.data && response.data.url) {
                            uploadedImgUrls.push(response.data.url);
                            progressBar.style.width = '100%';
                            progressBar.style.background = 'var(--success)';
                            
                            // Ù†Ù…Ø§ÛŒØ´ Ø¢ÛŒÚ©ÙˆÙ† Ù…ÙˆÙÙ‚ÛŒØª
                            const successIcon = document.createElement('div');
                            successIcon.className = 'status-icon';
                            successIcon.innerHTML = '<i class="fa fa-check-circle" style="color:var(--success)"></i>';
                            previewItem.appendChild(successIcon);
                            setTimeout(() => successIcon.remove(), SUCCESS_ICON_DISPLAY_DURATION);
                            
                            // Ø¨Ø±Ø±Ø³ÛŒ Ø§ØªÙ…Ø§Ù… Ù‡Ù…Ù‡ Ø¢Ù¾Ù„ÙˆØ¯Ù‡Ø§
                            checkAllUploadsComplete();
                        } else {
                            handleUploadError(previewItem, progressBar, `Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯: ${response.error ? response.error.message : 'Ù†Ø§Ù…Ø´Ø®Øµ'}`);
                        }
                    } else {
                        handleUploadError(previewItem, progressBar, `Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡: ${xhr.status}`);
                    }
                } catch(e) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø§Ø±Ø³ Ù¾Ø§Ø³Ø®:', e);
                    handleUploadError(previewItem, progressBar, 'Ø®Ø·Ø§ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾Ø§Ø³Ø® Ø³Ø±ÙˆØ±');
                }
            });
            
            // Ø±ÙˆÛŒØ¯Ø§Ø¯ Ø®Ø·Ø§
            xhr.addEventListener('error', () => {
                console.error(`Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ± ${index + 1}`);
                handleUploadError(previewItem, progressBar, 'Ø®Ø·Ø§ÛŒ Ø´Ø¨Ú©Ù‡ Ø¯Ø± Ø§ØªØµØ§Ù„');
            });
            
            xhr.open('POST', `https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`);
            xhr.send(formData);
        }
        
        function handleUploadError(previewItem, progressBar, errorMessage) {
            console.error(errorMessage);
            progressBar.style.width = '100%';
            progressBar.style.background = '#f44336';
            
            const errorIcon = document.createElement('div');
            errorIcon.className = 'status-icon';
            errorIcon.innerHTML = '<i class="fa fa-exclamation-circle" style="color:#f44336"></i>';
            previewItem.appendChild(errorIcon);
        }
        
        function checkAllUploadsComplete() {
            const txt = document.getElementById('up-txt');
            
            if(uploadedImgUrls.length === totalFilesToUpload) {
                txt.innerText = `âœ… ${uploadedImgUrls.length} Ø¹Ú©Ø³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯`;
                console.log('ØªÙ…Ø§Ù… ØªØµØ§ÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù†Ø¯:', uploadedImgUrls);
            } else if(uploadedImgUrls.length > 0) {
                txt.innerText = `âš ï¸ ${uploadedImgUrls.length} Ø§Ø² ${totalFilesToUpload} Ø¹Ú©Ø³ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯`;
            } else if(totalFilesToUpload > 0) {
                // Ù‡Ù…Ù‡ Ø¢Ù¾Ù„ÙˆØ¯Ù‡Ø§ Ø´Ú©Ø³Øª Ø®ÙˆØ±Ø¯Ù†Ø¯
                txt.innerText = `âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù¾Ù„ÙˆØ¯ ØªØµØ§ÙˆÛŒØ±. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯`;
            }
        }

        // --- ÙØ±Ù…â€ŒÙ‡Ø§ÛŒ Ù¾ÙˆÛŒØ§ (Ø¨Ø®Ø´ Û¶ Ú¯Ø§Ù†Ù‡) ---
        function updateForm() {
            const cat = document.getElementById('post-cat').value;
            const box = document.getElementById('dyn-sec');
            box.innerHTML = "";
            box.classList.remove('hidden');

            let html = "";
            if(cat === 'estate') {
                html = `
                    <label>Ù†ÙˆØ¹ Ù…Ù„Ú©:</label><select id="f-type"><option>Ø¢Ù¾Ø§Ø±ØªÙ…Ø§Ù†</option><option>ÙˆÛŒÙ„Ø§ÛŒÛŒ</option><option>Ø²Ù…ÛŒÙ†/Ú©Ù„Ù†Ú¯ÛŒ</option><option>ØªØ¬Ø§Ø±ÛŒ/Ø§Ø¯Ø§Ø±ÛŒ</option></select>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <div style="flex:1;"><label>Ù…ØªØ±Ø§Ú˜:</label><input type="number" id="f-area"></div>
                        <div style="flex:1;"><label>Ø§ØªØ§Ù‚:</label><input type="number" id="f-room"></div>
                    </div>
                    <label style="margin-top:10px;">Ø§Ù…Ú©Ø§Ù†Ø§Øª:</label>
                    <div class="amenities-grid">
                        <label class="check-box"><input type="checkbox" id="f-parking"> Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯</label>
                        <label class="check-box"><input type="checkbox" id="f-elevator"> Ø¢Ø³Ø§Ù†Ø³ÙˆØ±</label>
                        <label class="check-box"><input type="checkbox" id="f-warehouse"> Ø§Ù†Ø¨Ø§Ø±ÛŒ</label>
                    </div>
                `;
            } else if(cat === 'cars') {
                html = `
                    <label>Ø¨Ø±Ù†Ø¯:</label><input type="text" id="f-brand" placeholder="Ù…Ø«Ù„Ø§ Ù¾Ø±Ø§ÛŒØ¯">
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <div style="flex:1;"><label>Ø³Ø§Ù„ Ø³Ø§Ø®Øª:</label><input type="number" id="f-year"></div>
                        <div style="flex:1;"><label>Ú©Ø§Ø±Ú©Ø±Ø¯ (KM):</label><input type="number" id="f-km"></div>
                    </div>
                    <label style="margin-top:10px;">ÙˆØ¶Ø¹ÛŒØª Ø¨Ø¯Ù†Ù‡:</label><select id="f-body"><option>Ø³Ø§Ù„Ù… / Ø¨ÛŒâ€ŒØ±Ù†Ú¯</option><option>ØªØµØ§Ø¯ÙÛŒ</option><option>Ø¯ÙˆØ± Ø±Ù†Ú¯</option></select>
                `;
            } else if(cat === 'digital' || cat === 'home' || cat === 'parts') {
                html = `
                    <label>ÙˆØ¶Ø¹ÛŒØª Ú©Ø§Ù„Ø§:</label><select id="f-cond"><option>Ù†Ùˆ (Ø¢Ú©Ø¨Ù†Ø¯)</option><option>Ø¯Ø± Ø­Ø¯ Ù†Ùˆ</option><option>Ú©Ø§Ø±Ú©Ø±Ø¯Ù‡</option><option>Ù†ÛŒØ§Ø² Ø¨Ù‡ ØªØ¹Ù…ÛŒØ±</option></select>
                    <label style="margin-top:10px;">Ù†Ø­ÙˆÙ‡ ÙØ±ÙˆØ´:</label><select id="f-sale"><option>ØªÚ©ÛŒ</option><option>Ø¹Ù…Ø¯Ù‡</option></select>
                `;
            } else if(cat === 'jobs') {
                html = `
                    <label>Ù†ÙˆØ¹ Ø¢Ú¯Ù‡ÛŒ:</label><select id="f-role"><option>Ú©Ø§Ø±ÙØ±Ù…Ø§ (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÛŒâ€ŒÚ©Ù†Ù…)</option><option>Ú©Ø§Ø±Ø¬Ùˆ (Ø¯Ù†Ø¨Ø§Ù„ Ú©Ø§Ø±Ù…)</option></select>
                    <label style="margin-top:10px;">Ø­ÙˆØ²Ù‡ ÙØ¹Ø§Ù„ÛŒØª:</label><input type="text" id="f-field" placeholder="Ù…Ø«Ù„Ø§ Ø¨Ù†Ø§ÛŒÛŒØŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ...">
                `;
            } else {
                box.classList.add('hidden');
            }
            box.innerHTML = html;
        }

        // --- Ø§Ø±Ø³Ø§Ù„ Ø¢Ú¯Ù‡ÛŒ ---
        function submitAd() {
            const title = document.getElementById('post-title').value;
            const price = document.getElementById('post-price').value;
            const cat = document.getElementById('post-cat').value;
            
            if(!title || !price || !cat) {
                tg.showPopup({title:'Ù†Ø§Ù‚Øµ', message:'Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒØŒ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ù‚ÛŒÙ…Øª Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.'});
                return;
            }
            if(uploadedImgUrls.length === 0) {
                document.getElementById('err-img').style.display = 'block';
                return;
            }

            // Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø¯ÛŒØªØ§ÛŒ Ù¾ÙˆÛŒØ§
            let dets = {};
            if(cat === 'estate') {
                dets = {
                    'Ù†ÙˆØ¹': document.getElementById('f-type').value,
                    'Ù…ØªØ±Ø§Ú˜': document.getElementById('f-area').value,
                    'Ø§ØªØ§Ù‚': document.getElementById('f-room').value,
                    'Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯': document.getElementById('f-parking').checked,
                    'Ø¢Ø³Ø§Ù†Ø³ÙˆØ±': document.getElementById('f-elevator').checked,
                    'Ø§Ù†Ø¨Ø§Ø±ÛŒ': document.getElementById('f-warehouse').checked
                };
            } else if(cat === 'cars') {
                dets = {'Ø¨Ø±Ù†Ø¯':document.getElementById('f-brand').value, 'Ø³Ø§Ù„':document.getElementById('f-year').value, 'Ú©Ø§Ø±Ú©Ø±Ø¯':document.getElementById('f-km').value, 'Ø¨Ø¯Ù†Ù‡':document.getElementById('f-body').value};
            } else if(['digital','home','parts'].includes(cat)) {
                dets = {'ÙˆØ¶Ø¹ÛŒØª':document.getElementById('f-cond').value, 'ÙØ±ÙˆØ´':document.getElementById('f-sale').value};
            } else if(cat === 'jobs') {
                dets = {'Ù†Ù‚Ø´':document.getElementById('f-role').value, 'Ø­ÙˆØ²Ù‡':document.getElementById('f-field').value};
            }
            
            if(document.getElementById('post-exchange').checked) dets['Ù…Ø¹Ø§ÙˆØ¶Ù‡'] = true;

            const payload = {
                action: "new_post_full",
                cat: cat,
                title: title,
                price: price,
                country: document.getElementById('post-country').value,
                city: document.getElementById('post-city').value,
                desc: document.getElementById('post-desc').value,
                image_url: uploadedImgUrls[0], // Ø§ÙˆÙ„ÛŒÙ† ØªØµÙˆÛŒØ± Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† ØªØµÙˆÛŒØ± Ø§ØµÙ„ÛŒ
                image_urls: uploadedImgUrls,   // ØªÙ…Ø§Ù… ØªØµØ§ÙˆÛŒØ±
                details: dets,
                gps: {lat:0, long:0}
            };

            console.log('Ø§Ø±Ø³Ø§Ù„ Ø¢Ú¯Ù‡ÛŒ Ø¨Ø§ payload:', payload);
            tg.sendData(JSON.stringify(payload));
        }

        // --- Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ùˆ Ø«Ø¨Øª Ù†Ø§Ù… (ÙÛŒÚ©Ø³ Ø´Ø¯Ù‡) ---
        function saveProfile() {
            const name = document.getElementById('prof-name').value;
            const phone = document.getElementById('prof-phone').value;
            
            if(!name || !phone) {
                alert("Ù†Ø§Ù… Ùˆ Ø´Ù…Ø§Ø±Ù‡ Ù…ÙˆØ¨Ø§ÛŒÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª.");
                return;
            }

            const userData = {
                name: name,
                phone: phone,
                addr: document.getElementById('prof-addr').value,
                email: document.getElementById('prof-email').value,
                verified: false
            };
            
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± Ø­Ø§ÙØ¸Ù‡ Ú¯ÙˆØ´ÛŒ Ú©Ø§Ø±Ø¨Ø±
            localStorage.setItem('my_profile', JSON.stringify(userData));
            
            alert("âœ… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯.");
            loadProfile(); // Ø±ÙØ±Ø´ Ù†Ù…Ø§ÛŒØ´
        }

        function loadProfile() {
            const saved = localStorage.getItem('my_profile');
            if(saved) {
                const data = JSON.parse(saved);
                document.getElementById('prof-name').value = data.name;
                document.getElementById('prof-phone').value = data.phone;
                document.getElementById('prof-addr').value = data.addr;
                document.getElementById('prof-email').value = data.email;
                
                document.getElementById('prof-name-disp').innerText = data.name;
                // Ø§Ú¯Ø± Ù‚Ø¨Ù„Ø§ Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù‡ØŒ Ø¨Ø¬ Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù‡ Ù†Ø´ÙˆØ¯ ÛŒØ§ ØªØºÛŒÛŒØ± Ú©Ù†Ø¯ (ÙØ¹Ù„Ø§ Ø³Ø§Ø¯Ù‡)
                if(data.name) {
                     document.getElementById('badge-area').innerHTML = '<i class="fa fa-check-circle" style="color:green"></i> Ù¾Ø±ÙˆÙØ§ÛŒÙ„ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡';
                }
            }
        }
        
        // Ø§Ø³ØªØ§Ø±Øª Ø§ÙˆÙ„ÛŒÙ‡
        fetchAds();
        loadProfile();

    </script>
</body>
</html>
