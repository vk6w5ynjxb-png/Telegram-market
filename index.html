<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¨Ø§Ø²Ø§Ø± Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/telegram-web-app/6.11.0/telegram-web-app.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #2b95ff; --bg: #f5f5f5; --text: #333; --card: #fff; }
        body { font-family: Tahoma, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        
        .page { display: none; padding: 15px; }
        .page.active { display: block; animation: fade 0.3s; }
        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

        .menu-card { background: var(--card); border-radius: 15px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: space-between; font-weight: bold; }
        .ad-item { background: var(--card); border-radius: 12px; padding: 10px; margin-bottom: 10px; display: flex; gap: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .ad-img { width: 100px; height: 100px; border-radius: 8px; object-fit: cover; background: #eee; }
        .ad-info { flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
        .ad-price { color: var(--main); font-weight: bold; font-size: 15px; }
        
        .detail-img { width: 100%; height: 300px; object-fit: cover; }
        .detail-box { background: var(--card); border-radius: 25px 25px 0 0; margin-top: -30px; position: relative; padding: 25px; min-height: 300px; }
        
        .fab { position: fixed; bottom: 20px; left: 20px; width: 60px; height: 60px; background: var(--main); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; box-shadow: 0 5px 15px rgba(43, 149, 255, 0.4); font-size: 24px; cursor: pointer; }
        
        input, select, textarea { width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 10px; margin-bottom: 12px; background: #fff; box-sizing: border-box; }
        .submit-btn { width: 100%; padding: 15px; background: var(--main); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; }
        .upload-box { border: 2px dashed #ccc; padding: 30px; text-align: center; border-radius: 12px; background: #fff; margin-bottom: 15px; }
        .upload-box.done { border-color: green; background: #e8f5e9; }
    </style>
</head>
<body>

    <div id="page-home" class="page active">
        <h2 style="text-align:center; color: var(--main);">Ø¨Ø§Ø²Ø§Ø±Ú†Ù‡ Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ</h2>
        <div class="menu-card" onclick="loadAds('estate', 'Ø§ÛŒØ±Ø§Ù†')"><span>ğŸ  Ø§Ù…Ù„Ø§Ú© Ø§ÛŒØ±Ø§Ù†</span> <i class="fa fa-angle-left"></i></div>
        <div class="menu-card" onclick="loadAds('estate', 'Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†')"><span>ğŸ  Ø§Ù…Ù„Ø§Ú© Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</span> <i class="fa fa-angle-left"></i></div>
        <div class="menu-card" onclick="loadAds('goods', 'Ø§ÛŒØ±Ø§Ù†')"><span>ğŸ› Ø§Ø¬Ù†Ø§Ø³ Ø§ÛŒØ±Ø§Ù†</span> <i class="fa fa-angle-left"></i></div>
        <div class="menu-card" onclick="loadAds('goods', 'Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†')"><span>ğŸ› Ø§Ø¬Ù†Ø§Ø³ Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</span> <i class="fa fa-angle-left"></i></div>
        <div class="fab" onclick="showPage('page-post')"><i class="fa fa-plus"></i></div>
    </div>

    <div id="page-list" class="page">
        <div style="display:flex; align-items:center; margin-bottom:20px;">
            <i class="fa fa-arrow-right" onclick="showPage('page-home')" style="font-size:20px; padding:10px;"></i>
            <h3 id="list-title" style="flex:1; text-align:center; margin:0;">...</h3>
            <div style="width:40px;"></div>
        </div>
        <div id="ads-container"></div>
    </div>

    <div id="page-detail" class="page" style="padding:0;">
        <img id="d-img" class="detail-img">
        <div class="detail-box">
            <h2 id="d-title"></h2>
            <div id="d-price" style="color:var(--main); font-size:20px; font-weight:bold; margin:10px 0;"></div>
            <div id="d-loc" style="color:#777; margin-bottom:20px;"></div>
            <p id="d-desc" style="line-height:1.8; color:#444;"></p>
            <button class="submit-btn" onclick="showPage('page-list')">Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
    </div>

    <div id="page-post" class="page">
        <h3>Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ Ø¬Ø¯ÛŒØ¯</h3>
        <div class="upload-box" onclick="document.getElementById('file').click()" id="up-div">
            <i class="fa fa-camera" style="font-size:30px; color:#aaa;"></i><br>
            <span id="up-txt">Ø§Ù†ØªØ®Ø§Ø¨ Ø¹Ú©Ø³</span>
        </div>
        <input type="file" id="file" accept="image/*" style="display:none" onchange="uploadFile(this)">
        <select id="country"><option value="Ø§ÛŒØ±Ø§Ù†">Ø§ÛŒØ±Ø§Ù†</option><option value="Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†">Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†</option></select>
        <input type="text" id="city" placeholder="Ø´Ù‡Ø±">
        <input type="text" id="addr" placeholder="Ø¢Ø¯Ø±Ø³ Ø¯Ù‚ÛŒÙ‚">
        <select id="cat"><option value="estate">Ø§Ù…Ù„Ø§Ú©</option><option value="goods">Ø§Ø¬Ù†Ø§Ø³</option></select>
        <input type="text" id="title" placeholder="Ø¹Ù†ÙˆØ§Ù†">
        <input type="number" id="price" placeholder="Ù‚ÛŒÙ…Øª">
        <textarea id="desc" rows="3" placeholder="ØªÙˆØ¶ÛŒØ­Ø§Øª..."></textarea>
        <button class="submit-btn" onclick="sendData()">Ø«Ø¨Øª Ø¢Ú¯Ù‡ÛŒ</button>
        <button class="submit-btn" style="background:#eee; color:#333; margin-top:10px;" onclick="showPage('page-home')">Ø§Ù†ØµØ±Ø§Ù</button>
    </div>

    <script>
        // ğŸ”´ğŸ”´ğŸ”´ Ø§ÛŒÙ†Ø¬Ø§ Ú©Ù„ÛŒØ¯ ImgBB Ø®ÙˆØ¯ØªØ§Ù† Ø±Ø§ Ø¨Ú¯Ø°Ø§Ø±ÛŒØ¯ ğŸ”´ğŸ”´ğŸ”´
        const IMGBB_KEY = "YOUR_IMGBB_API_KEY"; 
        
        // Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ø§Ø¨Ø±ÛŒ (Ù¾Ø± Ø´Ø¯Ù‡)
        const BIN_ID = "6967e3d043b1c97be930be0f";
        const MASTER_KEY = "$2a$10$qkOl1I02u1dd9Juv25BMv.IsrpbnJq2vYlA.XxkmrvcMdd6G/Iv8q";

        const tg = window.Telegram.WebApp;
        tg.expand();
        let imgUrl = "";

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            window.scrollTo(0,0);
        }

        async function loadAds(cat, country) {
            document.getElementById('list-title').innerText = "Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯ÛŒØ±ÛŒ...";
            showPage('page-list');
            const box = document.getElementById('ads-container');
            box.innerHTML = "";

            try {
                const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': MASTER_KEY }
                });
                const data = await res.json();
                const ads = data.record;
                const filtered = ads.filter(a => a.cat === cat && a.country === country);
                document.getElementById('list-title').innerText = `${cat==='estate'?'Ø§Ù…Ù„Ø§Ú©':'Ø§Ø¬Ù†Ø§Ø³'} - ${country}`;

                if(filtered.length === 0) box.innerHTML = "<p style='text-align:center; color:#999; margin-top:50px;'>Ø¢Ú¯Ù‡ÛŒ Ù…ÙˆØ¬ÙˆØ¯ Ù†ÛŒØ³Øª</p>";

                filtered.reverse().forEach(ad => {
                    const pic = ad.img || "https://via.placeholder.com/150";
                    box.innerHTML += `
                        <div class="ad-item" onclick="detail('${ad.title}', '${ad.price}', '${pic}', '${ad.city}', '${ad.desc}')">
                            <img src="${pic}" class="ad-img">
                            <div class="ad-info">
                                <div>${ad.title}</div>
                                <div style="font-size:12px; color:#777;">ğŸ“ ${ad.city}</div>
                                <div class="ad-price">${parseInt(ad.price).toLocaleString()}</div>
                            </div>
                        </div>`;
                });
            } catch(e) { alert("Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: " + e); }
        }

        function detail(t, p, i, c, d) {
            document.getElementById('d-img').src = i;
            document.getElementById('d-title').innerText = t;
            document.getElementById('d-price').innerText = parseInt(p).toLocaleString();
            document.getElementById('d-loc').innerText = `ğŸ“ ${c}`;
            document.getElementById('d-desc').innerText = d;
            showPage('page-detail');
        }

        function uploadFile(inp) {
            const file = inp.files[0];
            if(!file) return;
            document.getElementById('up-txt').innerText = "â³ ...";
            const fd = new FormData();
            fd.append("image", file);
            fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, { method: "POST", body: fd })
            .then(r => r.json()).then(d => {
                if(d.success) {
                    imgUrl = d.data.url;
                    document.getElementById('up-div').classList.add('done');
                    document.getElementById('up-div').innerHTML = `<img src="${imgUrl}" style="width:100%; height:80px; object-fit:cover; border-radius:10px;">`;
                }
            });
        }

        function sendData() {
            const title = document.getElementById('title').value;
            const price = document.getElementById('price').value;
            if(!title || !price) { tg.showPopup({title:'Ø®Ø·Ø§', message:'Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª'}); return; }

            const data = {
                action: "new_post_full",
                title: title, price: price,
                city: document.getElementById('city').value,
                country: document.getElementById('country').value,
                address: document.getElementById('addr').value,
                cat: document.getElementById('cat').value,
                desc: document.getElementById('desc').value,
                image_url: imgUrl, details: {}, gps: {lat:0, long:0}
            };
            tg.sendData(JSON.stringify(data));
        }
    </script>
</body>
</html>
